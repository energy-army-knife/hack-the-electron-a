{% extends 'base.html' %}
{% load static %}

{%  block header %}
    <script>
        var percentage_last_month_peak = {{ percentage_last_month_peak }};
        var percentage_last_month_off_peak = {{ percentage_last_month_off_peak }};
        var percentage_last_month_super_off_peak = {{ percentage_last_month_super_off_peak }};

        var percentage_last_month_peak_cost = {{ percentage_last_month_peak_cost }};
        var percentage_last_month_off_peak_cost = {{ percentage_last_month_off_peak_cost }};
        var percentage_last_month_super_off_peak_cost = {{ percentage_last_month_super_off_peak_cost }};
        var period_start = {{ period_start }};
        var period_end = {{ period_end }};

        var power_loader_meter_hours_max = {{ power_loader_meter_hours_max|safe }};
        var power_spent_by_hours_label= {{ power_spent_by_hours_label|safe }};

    </script>
{% endblock %}

{% block content %}
<!-- MAIN CONTENT-->
<div class="main-content">
    <div class="section__content section__content--p30">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12">
                    <div class="overview-wrap">
                        <h2 class="title-1">Analyser</h2>
                    </div>
                </div>
            </div>
            <form action="{% url 'analyser' %}?meter={{ meter_id }}" method="post">
                {% csrf_token  %}
                 <input type="hidden" name="meter_id" value="{{ meter_id }}">
                <div class="form-group row">
                  <label for="id-date-start" class="col-2 col-form-label">Date</label>
                  <div class="col-3">
                    <input class="form-control" type="date" value={{ period_start }} id="id-date-start" name="date-start">
                  </div>
                     <div class="col-3">
                    <input class="form-control" type="date" value={{ period_end }} id="id-date-end" name="date-end">
                  </div>
                    <div>
                    <button type="submit" class="btn btn-dark">Ok</button>
                </div>
                </div>
            </form>


            <div class="row m-b-30">
                <div class="col-5">
                    <div class="au-card" style="height: 100%">
                        <div class="au-card-inner" style="height: 100%">

                            <div class="plot-position">
                                <div class="row no-gutters">
                                    <div class="col-4">
                                        <div class="chart-note-wrap">
                                            <div class="chart-note mr-0 d-block">
                                                <span class="dot dot--blue"></span>
                                                <span>Peak</span>
                                            </div>
                                            {% if tariff > 1 %}
                                            <div class="chart-note mr-0 d-block">
                                                <span class="dot dot--red"></span>
                                                <span>Off-Peak</span>
                                            </div>
                                            {% endif %}
                                            {% if tariff > 2 %}
                                            <div class="chart-note mr-0 d-block">
                                                <span class="dot dot--green"></span>
                                                <span>Super-Off-Peak</span>
                                            </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                <div class="col-8">
                                    <canvas id="percent-chart"></canvas>
                                </div>

                                <div class="chart-note-wrap">
                                    <div class="chart-note mr-0 d-block">
                                        <span>Inner circle: % of the bill in each Tariff period</span>
                                    </div>
                                    <div class="chart-note mr-0 d-block">
                                        <span>Outer circle: % of the total used power in each Tariff period</span>
                                    </div>
                                </div>
                            </div>
                           {% if current_tariff != best_tariff %}
                                <div class="alert alert-danger alert-position" role="alert" style="margin-top: 20px">
                                  Tariff not optimized for your power consumption, click <a href="{% url 'tariff_subscription' %}?meter={{ meter_id }}" class="alert-link">here</a>.
                                </div>
                           {% else %}
                               <div class="alert alert-success alert-position" role="alert" style="margin-top: 20px">
                                  Congratulations! Your current tariff {{ current_tariff }} is optimized for your power consumption! Detailed info <a href="{% url 'tariff_subscription' %}?meter={{ meter_id }}" class="alert-link">here</a>.
                                </div>
                          {% endif %}

                      </div>
                    </div>
                </div>
                </div>
                <div class="col-7">
                    <div class="au-card" style="height: 100%">
                        <div class="au-card-inner" style="height: 100%">
                        <div class="progress">
                          <div class="progress-bar" role="progressbar" style="width: {{ percentage_contracted_power_registered }}%;" aria-valuenow="{{ percentage_contracted_power_registered }}" aria-valuemin="0" aria-valuemax="100">{{ max_contracted_power_registered }}/{{ contracted_power }} kW</div>
                        </div>

                          <canvas id="power-mean-month"></canvas>
                          {% if contracted_power != best_contracted_power %}
                            <div class="alert alert-danger alert-position" role="alert">
                              Contracted power {{ contracted_power }} is not optimized click <a href="{% url 'contract_subscription' %}?meter={{ meter_id }}" class="alert-link">here</a>.
                            </div>
                        {% endif %}
                      </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div class="copyright">
                        <p>Copyright Â© 2018 Colorlib. All rights reserved. Template by <a href="https://colorlib.com">Colorlib</a>.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}